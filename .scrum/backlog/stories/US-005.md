# US-005: GCE Deployment Scripts

## Story Details

| Field | Value |
|-------|-------|
| **Story ID** | US-005 |
| **Epic** | EPIC-INFRA |
| **Title** | GCE Deployment Scripts |
| **Priority** | Medium |
| **Story Points** | 5 |
| **Status** | Ready |
| **Assignee** | Unassigned |
| **Sprint** | Sprint 2 |

## User Story

**As a** DevOps engineer,
**I want** deployment scripts for Google Compute Engine,
**So that** I can easily deploy and manage the platform on GCE instances.

## Description

Create comprehensive deployment scripts for deploying the OpenClaw platform to Google Compute Engine. This includes initial setup scripts, deployment automation, service management, and rollback capabilities.

## Acceptance Criteria

- [ ] Quick setup script for new GCE instances
- [ ] Deploy script with build and restart options
- [ ] Service management scripts (start, stop, restart)
- [ ] Log viewing script with follow option
- [ ] Health check script for all services
- [ ] Rollback capability to previous version
- [ ] Scripts are idempotent (safe to run multiple times)
- [ ] Clear error messages and exit codes
- [ ] Documentation for each script

## Technical Notes

### Script Structure

```
deployments/gce/
  quick-setup.sh      # Initial GCE setup
  deploy.sh           # Main deployment script
  scripts/
    start.sh          # Start services
    stop.sh           # Stop services
    restart.sh        # Restart services
    logs.sh           # View logs
    status.sh         # Health check
    rollback.sh       # Rollback to previous
  README.md           # Documentation
```

### Quick Setup Script

```bash
#!/bin/bash
# quick-setup.sh - Initial GCE instance setup

# Install Docker
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER

# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Clone repository
git clone https://github.com/your-org/openclaw.git /opt/openclaw

# Setup environment
cd /opt/openclaw
cp .env.example .env
./scripts/generate-passwords.sh
```

### Deploy Script Features

```bash
# Usage: deploy.sh [options]
# Options:
#   --setup    Initial setup only
#   --build    Rebuild Docker images
#   --restart  Restart services only
#   --full     Deploy full stack
```

### Service Management

```bash
# Start specific service or all
./scripts/start.sh [service]

# View logs with follow
./scripts/logs.sh gateway -f

# Check health status
./scripts/status.sh
```

### Files to Create/Modify
- `deployments/gce/quick-setup.sh`
- `deployments/gce/deploy.sh`
- `deployments/gce/scripts/start.sh`
- `deployments/gce/scripts/stop.sh`
- `deployments/gce/scripts/restart.sh`
- `deployments/gce/scripts/logs.sh`
- `deployments/gce/scripts/status.sh`
- `deployments/gce/scripts/rollback.sh`
- `deployments/gce/README.md`

## Dependencies

- GCE instance provisioned
- SSH access configured
- Domain DNS pointing to instance

## Definition of Done

- [ ] All scripts created and tested
- [ ] Scripts pass shellcheck validation
- [ ] Fresh deployment tested on new instance
- [ ] Rollback tested successfully
- [ ] README documentation complete
- [ ] Team trained on deployment process

---

*Created: 2026-02-08*
