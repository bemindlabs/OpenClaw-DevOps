# US-003: SSL/TLS Configuration

## Story Details

| Field | Value |
|-------|-------|
| **Story ID** | US-003 |
| **Epic** | EPIC-INFRA |
| **Title** | SSL/TLS Configuration |
| **Priority** | High |
| **Story Points** | 3 |
| **Status** | Ready |
| **Assignee** | Unassigned |
| **Sprint** | Sprint 1 |

## User Story

**As a** security engineer,
**I want** SSL/TLS configured for all domains,
**So that** all traffic is encrypted and users see the secure padlock in their browsers.

## Description

Implement SSL/TLS encryption for all domains using either Let's Encrypt certificates or manually provisioned certificates. Configure Nginx to handle HTTPS traffic, redirect HTTP to HTTPS, and implement security best practices including HSTS and modern cipher suites.

## Acceptance Criteria

- [ ] SSL certificates installed for all domains
- [ ] HTTP automatically redirects to HTTPS (301)
- [ ] HSTS header enabled with 1-year max-age
- [ ] TLS 1.2 and 1.3 only (no TLS 1.0/1.1)
- [ ] Modern cipher suites configured
- [ ] SSL Labs score of A or higher
- [ ] Certificate auto-renewal configured (Let's Encrypt)
- [ ] OCSP stapling enabled
- [ ] Certificate files properly protected (chmod 600)

## Technical Notes

### IEEE Requirement References
- IEEE-STD-INFRA-003: Security Standards

### SSL Configuration

```nginx
# In server block
listen 443 ssl http2;

ssl_certificate /etc/nginx/ssl/fullchain.pem;
ssl_certificate_key /etc/nginx/ssl/privkey.pem;

ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;
ssl_prefer_server_ciphers off;

ssl_session_timeout 1d;
ssl_session_cache shared:SSL:50m;
ssl_session_tickets off;

ssl_stapling on;
ssl_stapling_verify on;
```

### HSTS Header

```nginx
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
```

### HTTP to HTTPS Redirect

```nginx
server {
    listen 80;
    server_name your-domain.com *.your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

### Certificate Directory Structure

```
nginx/ssl/
  fullchain.pem     # Certificate chain
  privkey.pem       # Private key
  dhparam.pem       # DH parameters (optional)
```

### Let's Encrypt Integration

```bash
# Certbot command for initial setup
certbot certonly --webroot \
  -w /var/www/certbot \
  -d your-domain.com \
  -d openclaw.your-domain.com \
  -d assistant.your-domain.com
```

### Files to Create/Modify
- `nginx/conf.d/*.conf` (add SSL blocks)
- `nginx/ssl/` directory structure
- `scripts/renew-certs.sh`

## Dependencies

- Nginx reverse proxy setup (US-002)
- DNS configured for all domains
- Port 443 open in firewall

## Definition of Done

- [ ] SSL certificates installed and valid
- [ ] All domains accessible via HTTPS
- [ ] HTTP redirects to HTTPS
- [ ] SSL Labs test score A or higher
- [ ] Auto-renewal tested
- [ ] Documentation updated

---

*Created: 2026-02-08*
