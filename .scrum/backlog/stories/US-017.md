# US-017: Log Viewer Component

## Story Details

| Field | Value |
|-------|-------|
| **Story ID** | US-017 |
| **Epic** | EPIC-ADMIN |
| **Title** | Log Viewer Component |
| **Priority** | High |
| **Story Points** | 5 |
| **Status** | Ready |
| **Assignee** | Unassigned |
| **Sprint** | Sprint 2 |

## User Story

**As an** administrator,
**I want** to view logs from all services in real-time,
**So that** I can debug issues and monitor system activity.

## Description

Create a log viewer component that streams logs from all services in real-time. Include filtering by service, log level, and text search. Support for pausing the stream and exporting logs.

## Acceptance Criteria

- [ ] Real-time log streaming via WebSocket
- [ ] Filter by service (dropdown)
- [ ] Filter by log level (DEBUG, INFO, WARN, ERROR)
- [ ] Text search/filter on log content
- [ ] Pause/resume streaming toggle
- [ ] Auto-scroll to latest with manual scroll override
- [ ] Timestamp displayed for each log entry
- [ ] Color-coded by log level
- [ ] Clear logs button
- [ ] Export logs to file (JSON or text)
- [ ] Performance: handle 1000+ log entries

## Technical Notes

### IEEE Requirement References
- IEEE-STD-ADMIN-002: Real-time Features
- IEEE-STD-MON-004: Logging Standards

### Log Entry Interface

```typescript
// types/log.ts
export interface LogEntry {
  id: string;
  timestamp: Date;
  service: string;
  level: 'DEBUG' | 'INFO' | 'WARN' | 'ERROR';
  message: string;
  metadata?: Record<string, unknown>;
}
```

### Log Viewer Component

```tsx
// components/logs/log-viewer.tsx
interface LogViewerProps {
  maxEntries?: number;
}

export function LogViewer({ maxEntries = 1000 }: LogViewerProps) {
  const [logs, setLogs] = useState<LogEntry[]>([]);
  const [isPaused, setIsPaused] = useState(false);
  const [filters, setFilters] = useState<LogFilters>({
    service: null,
    level: null,
    search: '',
  });

  const containerRef = useRef<HTMLDivElement>(null);
  const shouldAutoScroll = useRef(true);

  // WebSocket connection for real-time logs
  useEffect(() => {
    if (isPaused) return;

    const socket = io('/logs');

    socket.on('log', (entry: LogEntry) => {
      setLogs((prev) => {
        const newLogs = [...prev, entry];
        // Keep only last N entries for performance
        return newLogs.slice(-maxEntries);
      });
    });

    return () => socket.disconnect();
  }, [isPaused, maxEntries]);

  // Filter logs
  const filteredLogs = useMemo(() => {
    return logs.filter((log) => {
      if (filters.service && log.service !== filters.service) return false;
      if (filters.level && log.level !== filters.level) return false;
      if (filters.search && !log.message.toLowerCase().includes(filters.search.toLowerCase())) {
        return false;
      }
      return true;
    });
  }, [logs, filters]);

  // Auto-scroll
  useEffect(() => {
    if (shouldAutoScroll.current && containerRef.current) {
      containerRef.current.scrollTop = containerRef.current.scrollHeight;
    }
  }, [filteredLogs]);

  return (
    <div className="flex flex-col h-full">
      <LogFilters filters={filters} onChange={setFilters} />
      <LogToolbar
        isPaused={isPaused}
        onPauseToggle={() => setIsPaused(!isPaused)}
        onClear={() => setLogs([])}
        onExport={() => exportLogs(filteredLogs)}
      />
      <ScrollArea
        ref={containerRef}
        className="flex-1 font-mono text-sm"
        onScroll={handleScroll}
      >
        {filteredLogs.map((log) => (
          <LogLine key={log.id} entry={log} />
        ))}
      </ScrollArea>
    </div>
  );
}
```

### Log Line Component

```tsx
// components/logs/log-line.tsx
const levelColors: Record<string, string> = {
  DEBUG: 'text-gray-500',
  INFO: 'text-blue-500',
  WARN: 'text-yellow-500',
  ERROR: 'text-red-500',
};

export function LogLine({ entry }: { entry: LogEntry }) {
  return (
    <div className="flex gap-2 py-1 px-2 hover:bg-muted/50 border-b border-border/50">
      <span className="text-muted-foreground whitespace-nowrap">
        {format(entry.timestamp, 'HH:mm:ss.SSS')}
      </span>
      <span className={cn('font-medium w-12', levelColors[entry.level])}>
        {entry.level}
      </span>
      <span className="text-muted-foreground w-24 truncate">
        [{entry.service}]
      </span>
      <span className="flex-1">{entry.message}</span>
    </div>
  );
}
```

### Log Filters Component

```tsx
// components/logs/log-filters.tsx
export function LogFilters({ filters, onChange }: LogFiltersProps) {
  return (
    <div className="flex gap-4 p-4 border-b">
      <Select
        value={filters.service || 'all'}
        onValueChange={(v) => onChange({ ...filters, service: v === 'all' ? null : v })}
      >
        <SelectTrigger className="w-40">
          <SelectValue placeholder="All Services" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">All Services</SelectItem>
          <SelectItem value="gateway">Gateway</SelectItem>
          <SelectItem value="landing">Landing</SelectItem>
          <SelectItem value="assistant">Assistant</SelectItem>
          <SelectItem value="nginx">Nginx</SelectItem>
        </SelectContent>
      </Select>

      <Select
        value={filters.level || 'all'}
        onValueChange={(v) => onChange({ ...filters, level: v === 'all' ? null : v })}
      >
        <SelectTrigger className="w-32">
          <SelectValue placeholder="All Levels" />
        </SelectTrigger>
        <SelectContent>
          <SelectItem value="all">All Levels</SelectItem>
          <SelectItem value="DEBUG">DEBUG</SelectItem>
          <SelectItem value="INFO">INFO</SelectItem>
          <SelectItem value="WARN">WARN</SelectItem>
          <SelectItem value="ERROR">ERROR</SelectItem>
        </SelectContent>
      </Select>

      <Input
        placeholder="Search logs..."
        value={filters.search}
        onChange={(e) => onChange({ ...filters, search: e.target.value })}
        className="flex-1 max-w-md"
      />
    </div>
  );
}
```

### Files to Create/Modify
- `apps/assistant/components/logs/log-viewer.tsx`
- `apps/assistant/components/logs/log-line.tsx`
- `apps/assistant/components/logs/log-filters.tsx`
- `apps/assistant/components/logs/log-toolbar.tsx`
- `apps/assistant/hooks/use-logs.ts`
- `apps/assistant/app/dashboard/logs/page.tsx`

## Dependencies

- WebSocket streaming support (US-013)
- Gateway log streaming API

## Definition of Done

- [ ] Logs stream in real-time
- [ ] All filters work correctly
- [ ] Pause/resume works
- [ ] Performance acceptable with 1000+ entries
- [ ] Export functionality works
- [ ] Accessible and keyboard navigable

---

*Created: 2026-02-08*
