# US-016: Service Health Dashboard

## Story Details

| Field | Value |
|-------|-------|
| **Story ID** | US-016 |
| **Epic** | EPIC-ADMIN |
| **Title** | Service Health Dashboard |
| **Priority** | High |
| **Story Points** | 5 |
| **Status** | Ready |
| **Assignee** | Unassigned |
| **Sprint** | Sprint 2 |

## User Story

**As an** administrator,
**I want** a real-time dashboard showing service health,
**So that** I can quickly identify issues and understand the system status at a glance.

## Description

Create a service health dashboard that displays the status of all platform services (Nginx, Landing, Gateway, Assistant, Databases, etc.) in real-time. Include health indicators, uptime metrics, and quick actions for each service.

## Acceptance Criteria

- [ ] Grid of service cards showing all services
- [ ] Real-time health status (healthy, degraded, unhealthy)
- [ ] Visual indicators (green/yellow/red badges)
- [ ] Last health check timestamp displayed
- [ ] Uptime percentage shown (last 24h, 7d)
- [ ] Quick actions: restart, view logs, view details
- [ ] Auto-refresh every 10 seconds
- [ ] Manual refresh button available
- [ ] Loading states for initial fetch
- [ ] Error handling for failed health checks

## Technical Notes

### IEEE Requirement References
- IEEE-STD-ADMIN-002: Real-time Features
- IEEE-STD-ADMIN-003: UI/UX Standards

### Service Card Component

```tsx
// components/services/service-card.tsx
interface ServiceCardProps {
  service: Service;
  onRestart: () => void;
  onViewLogs: () => void;
}

export function ServiceCard({ service, onRestart, onViewLogs }: ServiceCardProps) {
  return (
    <Card className="relative">
      <CardHeader className="flex flex-row items-center justify-between pb-2">
        <CardTitle className="text-lg font-medium">
          {service.name}
        </CardTitle>
        <HealthBadge status={service.status} />
      </CardHeader>
      <CardContent>
        <div className="space-y-2 text-sm">
          <div className="flex justify-between">
            <span className="text-muted-foreground">Port</span>
            <span>{service.port}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-muted-foreground">Uptime (24h)</span>
            <span>{service.uptime24h}%</span>
          </div>
          <div className="flex justify-between">
            <span className="text-muted-foreground">Last Check</span>
            <span>{formatRelative(service.lastCheck)}</span>
          </div>
        </div>
        <div className="flex gap-2 mt-4">
          <Button size="sm" variant="outline" onClick={onViewLogs}>
            <FileText className="h-4 w-4 mr-1" />
            Logs
          </Button>
          <Button size="sm" variant="outline" onClick={onRestart}>
            <RefreshCw className="h-4 w-4 mr-1" />
            Restart
          </Button>
        </div>
      </CardContent>
    </Card>
  );
}
```

### Health Badge Component

```tsx
// components/services/health-badge.tsx
type HealthStatus = 'healthy' | 'degraded' | 'unhealthy' | 'unknown';

const statusConfig: Record<HealthStatus, { label: string; className: string }> = {
  healthy: { label: 'Healthy', className: 'bg-green-500' },
  degraded: { label: 'Degraded', className: 'bg-yellow-500' },
  unhealthy: { label: 'Unhealthy', className: 'bg-red-500' },
  unknown: { label: 'Unknown', className: 'bg-gray-500' },
};

export function HealthBadge({ status }: { status: HealthStatus }) {
  const config = statusConfig[status];
  return (
    <Badge className={config.className}>
      {config.label}
    </Badge>
  );
}
```

### Service Hook

```tsx
// hooks/use-services.ts
export function useServices() {
  const [services, setServices] = useState<Service[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    const fetchServices = async () => {
      try {
        const response = await fetch('/api/services');
        const data = await response.json();
        setServices(data);
      } catch (err) {
        setError(err as Error);
      } finally {
        setLoading(false);
      }
    };

    fetchServices();
    const interval = setInterval(fetchServices, 10000);
    return () => clearInterval(interval);
  }, []);

  return { services, loading, error, refresh: fetchServices };
}
```

### Service Grid Page

```tsx
// app/dashboard/services/page.tsx
export default function ServicesPage() {
  const { services, loading, error, refresh } = useServices();

  if (loading) {
    return <ServiceGridSkeleton />;
  }

  if (error) {
    return <ErrorState error={error} onRetry={refresh} />;
  }

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">Services</h1>
        <Button onClick={refresh} variant="outline">
          <RefreshCw className="h-4 w-4 mr-2" />
          Refresh
        </Button>
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {services.map((service) => (
          <ServiceCard
            key={service.id}
            service={service}
            onRestart={() => handleRestart(service.id)}
            onViewLogs={() => router.push(`/dashboard/logs?service=${service.id}`)}
          />
        ))}
      </div>
    </div>
  );
}
```

### Files to Create/Modify
- `apps/assistant/components/services/service-card.tsx`
- `apps/assistant/components/services/health-badge.tsx`
- `apps/assistant/components/services/service-grid.tsx`
- `apps/assistant/hooks/use-services.ts`
- `apps/assistant/app/dashboard/services/page.tsx`
- `apps/assistant/app/api/services/route.ts`

## Dependencies

- Google OAuth integration (US-015)
- Gateway service health API endpoint

## Definition of Done

- [ ] Service grid displays all services
- [ ] Health status updates in real-time
- [ ] Actions (restart, logs) work correctly
- [ ] Loading and error states implemented
- [ ] Responsive on all breakpoints
- [ ] Accessible with keyboard

---

*Created: 2026-02-08*
